## Mongo DB 기본

### 1. Mongo DB 기본 개념

- Mongo DB 데이터의 기본 단위는 도큐먼트이고 이는 관계형 데이터베이스의 행과 유사하지만 더 강력
- 같은 맥락에서 Mongo DB의 컬렉션은 동적 스키마가 있는 RDB 테이블과 같음
- Mongo DB 단일 인스턴스는 자체적인 컬렉션을 갖는 여러 개의 독립적인 데이터베이스를 호스팅
- 모든 도큐먼트는 컬렉션 내에서 고유한 특수키인 `_id` 를 가진다
- Mongo DB는 `Mongo Shell` 이라는 간단하지만 강력한 도구와 함께 배포된다
  - Mongo Shell 은 Mongo DB 인스턴스를 관리하고 Mongo DB 쿼리 언어로 데이터를 조작하기 위한 내장 지원을 제공

### 2. 도큐먼트

- Mongo DB의 핵심
  - 정렬된 key 와 연결된 값으로 이뤄진 도큐먼트

````json
// "greeting" 이라는 key 에 "Hello, world!" 라는 값을 가진 도큐먼트
{ "greeting": "Hello, world!" }

// "greeting" 이라는 key 에 "Hello, world!" 라는 값을 갖고 "view" 라는 key 에 3이라는 값을 가진 도큐먼트
{ "greeting": "Hello, world!", "view" : 3 }
````

- 도큐먼트의 key 는 문자열이며, 다음 예외 몇가지를 제외하면 어떤 UTF-8 문자든 사용 가능

  - 키는 `\0(null)`을 포함하지 않는다 `\0` 은 키의 끝을 나타내는 데 사용
  - `.`과 `$`문자는 몇가지 특별한 속성을 가지며 특정 상황에서만 사용해야 한다. 이들은 `예약어`이기 떄문에 부적절하게 사용하면 드라이버에서 경고 발생
- Mongo DB는 `데이터형`과 `대소문자` 구별
- Mongo DB 에서 key 중복 불가능

````json
// 데이터형
{"count": 5}
{"count": "5"}

// 대소문자
{"count": 5}
{"Count": 5}
````

### 3. 컬렉션

- 컬렉션은 도큐먼트의 모음
- Mongo DB 의 도큐먼트가 관계형 데이터베이스의 행에 대응된다면, 컬렉션은 테이블에 대응

### 4. 동적 스키마

- 컬렉션은 동적 스키마를 가짐
  - 하나의 컬렉션 내 서로 다른 구조의 도큐먼트 존재 가능

  ````json
  { "greeting": "Hello, world!", "view" : 3 }
  { "signoff": "Good night, and good luck" }
  ````

  - 하나의 컬렉션에 여러 구조의 도큐먼트를 관리하지 않는 이유
    - 같은 컬렉션에 다른 종류의 도큐먼트 저장 시, 관리가 어려움
    - 컬렉션별로 목록은 뽑으면, 한 컬렉션 내 특정 데이터형별로 쿼리해서 목록을 뽑을 때보다 더욱 빠름
    - 같은 종류의 데이터를 하나의 컬렉션에 모아두면 데이터 지역성에 좋음
    - 인덱스를 만들려면 도큐먼트는 특정 구조를 가져야 함
        - 인덱스는 컬렉션별로 정의
        - 같은 유형의 도큐먼트를 하나의 컬렉션에 넣음으로써 컬렉션을 효율적으로 인덱싱 가능

### 5. 네이밍

- 컬렉션은 이름으로 식별
- 제약 조건
  - 빈 문자열은 유효한 컬렉션명으로 사용 불가
  - `\0(null)` 문자는 컬렉션명의 끝을 나타내는 문자이므로 컬렉션명으로 사용 불가
  - `system.` 으로 시작하는 컬렉션명은 시스템 컬렉션에서 사용하는 예약어로 사용 불가
    - `system.user` 컬렉션에는 데이터베이스 사용자 정보가 관리되며, `system.namespace` 컬렉션에는 데이터베이스 내 모든 컬렉션 정보 관리
  - 사용자가 만든 컬렉션은 이름에 예약어인 `$` 사용 불가
 
> 서브 컬렉션

- 서브 컬렉션은 네임스페이스에 `.(마침표)` 문자를 사용하여 컬렉션 체계화 가능
  - 예 : blog.post, blog.authors
  - 이는 단지 체계화하기 위함이며, blog 컬렉션이나 자식 컬렉션과는 아무런 관계 없음
- 서브 컬렉션은 특별한 속성은 없지만 여러 Mongo DB 툴에서 지원하므로 유용
  - 큰 파일을 저장하는 프로토콜인 GridFS는 콘텐츠 데이터와 별도로 메타데이터를 저장하는 데 서브컬렉션 사용
  - 대부분의 드라이버는 특정 컬렉션의 서브컬렉션에 접근하는 몇 가지 편리한 문법 제공
- 서브 컬렉션은 Mongo DB의 데이터를 체계화하는 훌륭한 방법
