## 07. 스프링 부트 메시징

- 메시지 연결을 활용한 컴포넌트 사이의 결합도를 낮춘 아키텍처 고도화
- 비동기 메시징은 동일한 어플리케이션 안에 있는 컴포넌트 또는 네트워크를 통해 연결된 여러 마이크로 서비스에 부산돼 있는 컴포넌트들을 연결하는 좋은 수단

- 7장에서 다루는 내용
  - 스프링 부트에서 지원하는 다양한 메시징 솔루션
  - 스프링 부트에서 직접 지원하지는 않지만 스프링 포트폴리오에서 지원하는 다양한 메시징 솔루션
  - AMQP(Advanced Message Queueing Protocol) 및 스프링 AMQP와 프로젝트 리액터를 활용해 웹 계층과 백엔드의 결합 관계 해소
  
### 메시징 솔루션 선택

- 메시징 솔루션은 JMS (Java Messaging Service), 아파치 카프카 (Kafka), AMQP, 레디스(Redis), 젬파이어(JemFire), 아파치 지오드(Geode) 등 매우 다양
- 메시징 솔루션들은 공통점도 많지만, 저마다의 관심사에 최적화

### 익순한 패턴을 사용한 문제 해결
- '자바의 복잡도 감소(reducing Java complexity)' 는 스프링 포트폴리오의 핵심 특징
- 스프링의 설계 목표는 무엇보다도 어플리케이션을 만드는 방법을 단순화하는 것
  - 이를 달성하는 가장 강력한 수단 중 하나가 '템플릿 패턴(template pattern)'
  - 본질적으로 '템플릿'이란 특정 API의 모든 복잡성을 가장 단순한 연산으로 축약하는 것을 의미
    - 'JdbcTemplate'이 가장 대표적
      - 스프링 프레임워크는 'JdbcTemplate'를 직접 제공 
      - 개발자는 SQL 쿼리문과 쿼리 결과 처리 방법만 제공하는데 집중
      - DB 연결, Cursor, 결과 구성, ResultSet 닫기 등은 모두 스프링이 처리 
- 이러한 템플릿 패턴은 비동기 메시징에서도 사용 
  - 직접 구현 시 복잡할 수 있는 API를 획기적으로 단순화한 '발행-구독(pub-sub)' 관련 유틸리티를 사용하여 쉽게 메시지 발행 및 구독 처리를 하는 메시지 리스너도 쉽게 등록 가능
  - JMS
    - 자바 표준 메시징 API 
    - JmsTemplate, DefaultMessageListnerContainer 제공
  - Apache Kafka
    - KafkaTemplate, KafkaMessageListnerContainer 제공
  - RabbitMQ
    - AmqpTemplateSimpleMessageListnerContainer 제공
  - Redis
    - RedisMessageListnerContainer 제공

### 손쉬운 테스트 
- AMQP 브로커인 RabbitMQ를 사용하는 테스트를 중심으로 메시지 처리 방법 분석 
- '테스트 컨테이너 (Testcontainers : https://testcontainers.org) 는 도커를 활용하는 자바 테스트 지원 라이브러리
  - 테스트가 종료되면 테스트에 사용됐던 여러 컨테이너들의 자원 종료

````xml
// 테스트컨테이너 버전 지정
<dependencyManagement>
  <dependencies>
    <dependency>
      <groupId>org.testcontainers</groupId>
      <artifactId>testcontainers-bom</artifactId>
      <version>1.15.2</version>
      <type>pom</type>
      <scope>import</scope>
    </dependency>
  </dependencies>
</dependencyManagement>
````

````xml
// RabbitMQ 테스트컨테이너 의존관계 추가
<dependency>
  <groupId>org.testcontainers</groupId>
  <artifactId>rabbitmq</artifactId>
  <scope>test</scope>
</dependency>

<dependency>
  <groupId>org.testcontainers</groupId>
  <artifactId>junit-jupiter</artifactId>
  <scope>test</scope>
</dependency>
````
- 도커 관리를 담당하는 핵심 의존 라이브러리 및 RabbitMQ 활성화 모듈 포함 
- rabbitmq:3.7-management-alpine 이미지를 도커 허브에서 가져와 테스트에 사용
- 테스트컨테이너는 집필 기준 JUnit4 기준으로 만들어져 JUnit5와 함께 사용하기 위해서는 'junit-jupiter' 모듈 추가 필요 

### 테스트컨테이너 사용 테스트 
