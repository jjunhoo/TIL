13. 마이크로서비스로 리팩토링

## 마이크로서비스 리팩토링 개요
- 어플리케이션을 처음부터 뜯어고치지 않아도 모놀리식 지옥에서 벗어날 수 있게 해주는 '스트랭글러 어플리케이션'을 개발해서 단계적으로 모놀리식을 마이크로서비스로 전환할 수 있다.
- 모놀리스에서 서비스를 하나씩 추출해서 새 기능을 구현하는 식으로 마이크로서비스 개발
- 이런 서비스로 구성된 스트랭글러 어플리케이션은 점점 더 키우고 모놀리스는 차츰 줄여나가는 방법의 전략

### 모놀리스를 왜 리팩토링하는가 ? 

- 모놀리스를 마이크로서비스로 리팩토링하는 작업은 매우 고된 여정
    - 새로운 기능 개발에 필요한 리소스가 분산됨
- 모놀리식에서의 비즈니스 문제
> 느린 전달 
- 어플리케이션을 이해, 관리, 테스트하기가 어려워서 개발자 생산성이 떨어짐

> 버그 투성이 소프트웨어 릴리즈
- 테스트의 결여는 곧 소프트웨어 릴리즈가 버그 투성이일 떄가 많다는 뜻

> 나쁜 확장성
- 모놀리식 어플리케이션은 리소스 요건이 전혀 다른 모듈을 하나의 실행 가능한 컴포넌트로 조합하기 때문에 확장이 어려움

### 모놀리스 옥죄기
- 마이크로서비스 아키텍처로 리팩토링할 때는 '완전히 뜯어고치기'를 삼가해야 함
    - 레거시와 걷어내고 처음부터 마이크로서비스로 가는 것는 리스크가 너무 커서 결국 실패하는 프로젝트가 될 가능성이 높음
    - 따라서, 모놀리식 어플리케이션을 단계적으로 리팩토링 하는 것이 좋음
- 아마존은 모놀리스를 리팩토링하는 데에만 2년 소요

>> 스트랭글러 어플리케이션 : 레거시 어플리케이션에 새(스트랭글러) 어플리케이션을 에둘러 단계적으로 개발하는 어플리케이션 현대화 패턴

> 값을 조기에 자주 검증
- 마이크로서비스 아키텍처로 단계적인 리팩토링을 수행하면 투자에 따른 보상을 즉시 받을 수 있음
- 어플리케이션에서 가치가 큰 부분을 먼저 마이크로서비스로 이전하는 것도 방법
    - FTGO 에서 '배달 스케줄링 알고리즘'을 핵심 경쟁 우위로 정했을 경우, 
    - 배달 관리를 stand-alone 서비스로 추출하면 독립적 개발 진행 및 개발 속도 향상 가능
    - 새 버전의 알고리즘을 더 자주 배포해서 효용성 평가 가능
- 따라서, 단계적으로 마이크로서비스를 리팩토링하면 전환 가치를 경영진에게 일찍, 더 자주 보여줄 수 있음

### 모놀리스 변경 최소화
- 모놀리스를 여기저기 많은 부분 변경하는 것은 시간도 많이 걸리며, 비싸고, 위험
- 따라서, 변경 범위를 줄일 수 있는 전략 필요
    - 추출된 서비스에 있는 데이터를 모놀리스 DB에 도로 복제
    - 모놀리스에 미치는 영향을 줄이기 위해 서비스 추출 순서 조정
    
### 기술 배포 인프라 : 모든 것이 다 필요한 것은 아니다
- 테스트 자동화 배포 파이프라인을 제외한 인프라 개발에 필요한 선행 투자는 최소화 하는 것이 좋음
- 서비스가 몇 개 되지 않는다면, 서비스를 운영해보며 어떤 기술이 나은지 경험을 쌓은 후 도입해도 늦지 않음

## 모놀리스 -> 마이크로서비스 리팩토링 전략

1. 새 기능을 서비스로 구현
    - 모놀리스의 성장 중단 전략
2. 표현 계층과 백엔드 분리
    - 모놀리스 분해 관련 전략
3. 기능을 여러 서비스로 추출해서 모놀리스를 분해
    - 모놀리스 분해 관련 전략
    
### 새 기능을 서비스로 구현한다
- 모놀리식 어플리케이션이 거의 관리 불능 상태라면 '구멍에 빠졌다는 것을 알았다면 땅은 그만 파라'는 조언을 상기하자

> 새 서비스를 모놀리스에 연계
- API 게이트웨이
    - 새 기능의 요청은 새 서비스로, 기존 요청은 모놀리스로 각각 라우팅
- 통합 글루 코드
    - 서비스가 모놀리스 데이터에 접근하고, 모놀리스에 구현된 기능을 호출할 수 있도록 서비스를 모놀리스에 통합
    
> 새 기능을 서비스로 구현하는 시점
- 기존 클래스에 필드/메서드 몇 개만 추가하면 되는 경우
- 새 기능이 기존 모놀리스 코드에 단단하게 매여 있는 경우
    - 위 상황에서 무리하게 마이크로서비스로 구현하려면 과도한 IPC가 발생하고 새로운 성능 문제 발생
    - 데이터 일관성 유지 문제 발생
- 따라서, 새 기능을 마이크로서비스로 구현할 수 없다면, 일단 모놀리스에 새로운 기능을 추가 후 추후에 자체 서비스로 추출

