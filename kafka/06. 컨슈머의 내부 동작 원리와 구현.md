## 컨슈머의 내부 동작 원리와 구현

### 6.1 컨슈머 오프셋 관리

- 컨슈머의 동작 중 가장 핵심은 '오프셋 관리'
- 컨슈머는 카프카에 저장된 메시지를 꺼내오는 역할을 하기 때문에 컨슈머가 메시지를 어디까지 가져왔는지를 표시하는 것은 매우 중요
- 컨슈머 그룹은 자신의 오프셋 정보를 토픽에 저장
  - consumer offsets 토픽에 각 컨슈머 그룹별로 오프셋 위치 정보 저장

> 컨슈머 기본 동작

![캡처](https://postfiles.pstatic.net/MjAyMjEwMTNfMjU0/MDAxNjY1NjY5ODg0NzQ3.9RB01YI4IXRcGdq-Si1fGZ7cKQmB6HEobwvMVq5qTNkg.bgIl7qItQnTp1dmmFauGqnfTmQ6I2-poi-Kgc6LIjUsg.JPEG.wnsghi1/IMG_1305.jpg?type=w773)

- 컨슈머 그룹 내 컨슈머들은 지정된 토픽의 메시지를 읽은 뒤 읽어온 위치의 오프셋 정보를 'consumer offsets' 에 저장
  - 컨슈머 그룹, 토픽, 파티션 등 내용을 통합하여 저장
- **\* 이를 통해 컨슈머 그룹은 자신의 그룹이 속해 있는 컨슈머의 변경(장애, 이탈 등)이 발생하는 경우, 해당 컨슈머가 어느 위치까지 읽었는지 추적 가능**

> 'consumer offsets' 토픽의 파티션 수 및 리플리케이션 팩터 수

- offsets.topic.num.partitions : 기본값 50 
- offsets.topic.replication.factor : 기본값 3
  - server.properties 파일을 통해 기본값 변경 가능 
