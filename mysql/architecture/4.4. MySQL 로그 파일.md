# 4.4. MySQL 로그 파일

## 4.4.1 에러 로그 파일

- 에러 로그 파일의 위치는 `MySQL 설정 파일(my.cnf)`에서 `log_error` 라는 이름의 파라미터로 정의된 경로에 생성
- MySQL 설정 파일에 별도로 정의되지 않은 경우, `datadir` 파라미터에 `.err` 라는 확장자가 붙은 파일로 생성

### 4.4.1.1 MySQL이 시작하는 과정과 관련된 정보성 및 에러 메시지

- MySQL 서버가 정상적으로 기동
  - ‘mysqld： ready for connections’ 메시지 확인), 새로 변경하거나 추가한 파라미터에 대한 특별한 에러나 경고성 메시지가 없다면 정상적으로 적용된 것으로 판단하면 됨
- 특정 변수가 무시된 경우
  - MySQL 서버는 정상적으로 기동하지만 해당 파라미터는 MySQL에 적용되지 못함
- 변수명이나 값을 인식하지 못하는 경우
  - 에러 메시지 출력하고, 시작하지 못했다는 메시지 출력

### 4.4.1.2 마지막으로 종료할 때 비정상적으로 종료된 경우 나타나는 InnoDB의 트랜잭션 복구 메시지

> InnoDB의 경우, MySQL 서버가 비정상적으로 종료됐다면 다시 시작되면서 `redo log` 를 읽어 완료하지 못한 트랜잭션을 다시 처리하는 작업 진행

- `innodb_force_recovery` : InnoDB 스토리지 엔진이 심각한 손상이나 크래시가 발생했을 때 데이터 복구를 시도하기 위해 사용하는 옵션

### 4.4.1.3 쿼리 처리 도중에 발생하는 문제에 대한 에러 메시지

- 쿼리 도중 발생하는 문제점은 사전 예방이 어려우며, 주기적으로 에러 로그 파일을 검토하는 과정에서 인지 가능
- 쿼리의 실행 도중 발생한 에러나 복제에서 문제가 될 만한 쿼리에 대한 경고 메시지가 에러 로그에 기록

### 4.4.1.4 비정상적으로 종료된 커넥션 메시지 (Aborted connection)

> `클라이언트 애플리케이션에서 정상적으로 접속 종료를 하지 못하고 프로그램이 종료된 경우` MySQL 서버의 에러 로그 파일에 이런 내용이 기록

- `max_connect_errors` : 클라이언트의 반복된 연결 실패 횟수에 따라 해당 IP 주소를 일시적으로 차단하는 보안 매커니즘

- 주요 원인 
  - 클라이언트 프로그램이 종료 전에 mysql_close()를 호출하지 않은 경우
  - 데이터 전송 중, 클라이언트 프로그램이 갑자기 종료된 경우
  - 클라이언트가 wait_timeout 과 같이 설정된 시간 이상으로 동작이 없는 경우
  - 클라이언트가 데이터베이스에 접근할 권한이 없는 경우
  - connection packet 이 올바른 정보를 가지고 있지 않은 경우
  - max_allowed_packet 변수 값이 너무 작게 설정되어 있거나 쿼리가 mysqld에 할당한 메모리보다 많은 양을 요구할 경우 (Packet Too Large)

### 4.4.1.5 InnoDB의 모니터링 또는 상태 조회 명령의 결과 메시지 (SHOW ENGINE INNODB STATUS)

- InnoDB의 `테이블 모니터링`, `락 모니터링`, `InnoDB의 엔진 상태를 조회`하는 명령은 상대적으로 큰 메시지를 에러 로그 파일에 기록
- `모니터링을 사용한 이후`에는 다시 `비활성화`해서 에러 로그 파일이 커지지 않게 만들어야 한다

### 4.4.1.6 MySQL 의 종료 메시지

>  MySQL 이 종료되거나 재시작 되는 경우, 사유를 찾기 위해서는 에러 로그 파일에서 MySQL이 마지막으로 종료되면서 출력한 메시지를 확인하는 것이 유일한 방법

1. MYSQL 서버를 누군가가 종료시킨 경우 
   - 에러 로그 파일에서 `Received SHUTDOWN from user` 메시지 확인 가능

2. 종료 관련 메시지가 없거나 스택 트레이스와 같이 출력되는 경우
   - 스택트레이스를 참조해서 MYSQL의 버전을 업그레이드 하거나 회피책을 찾는것이 최선의 방법
    
## 4.4.2 제너럴 쿼리 로그 파일





