## 6. Right-BICEP: 무엇을 테스트할 것인가?

> Right-BICEP 은 무엇을 테스트할지에 대해 쉽게 선별할 수 있도록 도와줌

- `Right` : 결과가 올바른가 ?
- `B`oundary conditions (경계 조건) 은 맞는가 ?
- `I`nverse relationship (역 관계) 을 검사할 수 있는가 ?
- `C`ross-check (교차 검사) 를 다른 수단을 활용하여 할 수 있는가 ?
- `E`rror conditions (오류 조건) 을 강제로 일어나게 할 수 있는가 ?
- `P`erformance characteristics (성능 조건) 은 기준에 부합하는가 ?

### Right : 결과가 올바른가 ?

> 테스트 코드는 무엇보다도 먼저 `기대한 결과 (단언, assert) 를 산출하는지 검증` 할 수 있어야 한다.

### Boundary conditions: 경계 조건은 맞는가 ?

> 행복 경로 (Happy Path) 는 입력 값의 양극단을 다루는 코드 시나리오의 경계 조건에 걸리지 않을 수 있다.

- 수많은 결함은 이러한 모서리 사례 (Corner Case) 이므로 이것들을 테스트로 처리해야 한다.
- 생각해야 하는 경계 조건은 다음과 같다.
  - 모호하고 일관성 없는 입력 값 (예 : 특수 문자가 포함된 파일 이름)
  - 잘못된 양식의 데이터 (예 : 최상위 도메인이 빠진 이메일 주소)
  - 수치적으로 오버플로우를 일으키는 계산
  - 비거나 빠진 값 (예 : 0, 0.0, "" 혹은 null)
  - 이성적인 기댓값을 훨씬 벗어나는 값 (예 : 150세의 나이)
  - 중복을 허용해서는 안 되는 목록에 중복 값이 있는 경우
  - 정렬이 안 된 정렬 리스트 혹은 그 반대 (예 :정렬 알고리즘에 이미 정렬된 입력 값을 넣는 경우나 정렬 알고리즘에 역순 데이터를 넣는 경우)
  - 시간 순이 맞지 않는 경우. (예 : HTTP 서버가 OPTIONS 메서드의 결과를 POST 메서드보다 먼저 반환해야 하지만 그 후에 반환하는 경우)

### 경계 조건에서는 CORRECT 를 기억하라

- `C`onformance (준수) : 값이 기대한 양식을 준수하고 있는가?
- `O`rdering (순서) : 값의 집합이 적절하게 정렬되거나 정렬되지 않았나?
- `R`ange (범위) : 이성적인 최솟값과 최대값 안에 있는가?
- `R`eference (참조) : 코드 자체에서 통제할 수 없는 어떤 외부 참조를 포함하고 있는가?
- `E`xistence (존재) : 값이 존재하는가? (null 이 아니거나(non-null), 0이 아니거나(nonzero), 집합에 존재하는가 등)
- `C`ardinality (집합의 크기, 기수) : 정확히 충분한 값들이 있는가?
- `T`ime (절대적 혹은 상대적 시간) : 모든 것이 순서대로 일어나는가? (정확한 시간 또는 순서)

### Inverse relationship: 역 관계를 검사할 수 있는가?

- 때때로 `논리적인 역 관계를 적용`하여 행동을 검사할 수 있다.
  - 예 : 곱셈으로 나눗셈을 검증하고 뺄셈으로 덧셈을 검증

### Cross-check: 다른 수단을 활용하여 교차 검사할 수 있는가?

- 예를 들어 제곱근을 구하는 메소드가 있다면 우리는 자바의 Math.sqrt()를 이용해 결과가 동일한지 테스트할 수도 있지만, 다른 수단을 이용해 조금은 정확도가 떨어지더라도 제곱근 자바 라이브러리를 이용해서도 교차 테스트 가능
  - 어떠한 상황에서든지 동일한 테스트 결과를 낼수 있어야 한다.

### Error conditions: 오류 조건을 강제로 일어나게 할 수 있는가?

- 행복 경로 (happy path) 가 있다는 것은 `불행한 경로`도 있다는 것을 의미
  - 디스크 Full, 네트워크 단절, 프로그램 중단 등
- 테스트 코드로 실전 문제를 우아하고 이성적인 방식으로 다루고 싶다면, 오류들을 강제로 발생시켜야 한다.
- 코드를 테스트하기 위해 도입할 수 있는 오류의 종류 혹은 다른 환경적인 제약 사항
  - 메모리가 가득 찰 때
  - 디스크 공간이 가득 찰 때
  - 시간에 관한 문제들 (클라이언트와 서버의 시간이 달라서 생기는 문제)
  - 네트워크 가용성 및 오류들
  - 시스템 로드

### Performance characteristics: 성능 조건은 기준에 부합하는가?

- 많은 프로그래머가 성능 문제가 어디에 있으며 최적의 해법이 무엇인지 추측하지만, 종종 잘못되었다는 것이 문제다.
- 추측만으로 대응하기보다는 `단위 테스트를 설계`하여 진짜 문제가 어디에 있고 `예상한 변경 사항으로 어떤 차이가 생겼는지 파악`해야 한다.
- 몇 가지 주의 사항이 존재한다.
  - 전형적으로 코드 덩어리를 `충분한 횟수`만큼 실행한다. (타이밍과 CPU 클록 주기에 관한 이슈 제거)
  - 반복하는 코드 부분을 `자바(JVM)가 최적화하지 못하는지 확인`해야 한다.
  - 최적화되지 않는 테스트는 일반 테스트보다 매우 느리다. (이런 `느린 테스트는 빠른 것과 분리` 필요)
  - 동일한 기계여도 `실행 시간은 시스템 로드 같은 다양한 요소에 의해 달라질 수 있다.`
- 단위 성능 측정을 잘 사용하는 방법은 변경 사항을 만들 때 기준점(baseline)으로 활용하는 것이다.
  - 먼저, 최적화 전에 현재 경과 시간 (elapsed time)을 측정하는 성능 테스트를 만든다.
  - 몇 번 실행해 보고 평균을 계산한다.
  - 코드 변경 후 성능 테스트를 다시 실행하고, 결과를 비교한다.
- 성능이 핵심 고려 사항이라면, 단위 테스트보다는 더 고수준으로 `JMeter` 도구 등을 이용한 테스트를 하는 것이 나을 수도 있다.
